[gd_scene load_steps=3 format=3 uid="uid://qtd4jtukqvh3"]

[ext_resource type="PackedScene" uid="uid://dyc75iewallhd" path="res://api/EasyLeaderboard.tscn" id="1_f4dny"]

[sub_resource type="GDScript" id="GDScript_7ko77"]
script/source = "extends Control

@export var row_scene : PackedScene = preload(\"res://leaderboard/LeaderboardRow.tscn\")

@export var page_size = 10
@export var current_page = 1
@export var leaderboard_title = \"Leaderboard\"

# Using same defaults as the API
@export var easy_leaderboard_url = EasyLeaderboard.DEFAULT_EASY_LEADERBOARD_URL
@export var game_name = EasyLeaderboard.DEFAULT_GAME_NAME
@export var sort_results_asc = EasyLeaderboard.DEFAULT_SORT_RESULTS_ASCENDING


@onready var results_container : GridContainer = $LeadboardPanel/ResultsGridContainer
@onready var easy_leaderboard_api : EasyLeaderboard = $EasyLeaderboard
@onready var prev_button : Button = $LeadboardPanel/GridContainer/PrevButtonContainer/PrevButton
@onready var next_button : Button = $LeadboardPanel/HeaderGridContainer/NextButtonContainer/NextButton

# Called when the node enters the scene tree for the first time.
func _ready():
	easy_leaderboard_api.get_leaderboard_results()
	$LeadboardPanel/HeaderGridContainer/LeaderboardTitle.text = leaderboard_title
	

func _check_prev_button_valid():
	prev_button.disabled = current_page == 1


func _on_easy_leaderboard_leaderboard_results_changed(results):
	# Remove old results
	for child in results_container.get_children():
		results_container.remove_child(child)
	
	var row_number = page_size * (current_page - 1)
	for result in results:
		row_number = row_number + 1
		
		var row = row_scene.instantiate()
		
		row.result_number = row_number
		row.score_name = result.name
		row.score_value = result.score
		
		results_container.add_child(row)


func _on_easy_leaderboard_leaderboard_score_submitted():
	pass # Replace with function body.
"

[node name="Leaderboard" type="Control"]
layout_mode = 3
anchors_preset = 0
script = SubResource("GDScript_7ko77")

[node name="EasyLeaderboard" parent="." instance=ExtResource("1_f4dny")]

[node name="LeadboardPanel" type="Panel" parent="."]
layout_mode = 0
offset_left = 253.0
offset_top = 14.0
offset_right = 896.0
offset_bottom = 621.0

[node name="HeaderGridContainer" type="GridContainer" parent="LeadboardPanel"]
layout_mode = 0
offset_right = 643.0
offset_bottom = 33.0
columns = 3

[node name="PrevButtonContainer" type="CenterContainer" parent="LeadboardPanel/HeaderGridContainer"]
layout_mode = 2
offset_right = 268.0
offset_bottom = 31.0
size_flags_horizontal = 3

[node name="PrevButton" type="Button" parent="LeadboardPanel/HeaderGridContainer/PrevButtonContainer"]
layout_mode = 2
offset_left = 112.0
offset_right = 155.0
offset_bottom = 31.0
size_flags_horizontal = 3
disabled = true
text = "Prev"

[node name="LeaderboardTitle" type="Label" parent="LeadboardPanel/HeaderGridContainer"]
layout_mode = 2
offset_left = 272.0
offset_top = 2.0
offset_right = 372.0
offset_bottom = 28.0
text = "Leaderboard"
horizontal_alignment = 1

[node name="NextButtonContainer" type="CenterContainer" parent="LeadboardPanel/HeaderGridContainer"]
layout_mode = 2
offset_left = 376.0
offset_right = 643.0
offset_bottom = 31.0
size_flags_horizontal = 3

[node name="NextButton" type="Button" parent="LeadboardPanel/HeaderGridContainer/NextButtonContainer"]
layout_mode = 2
offset_left = 111.0
offset_right = 156.0
offset_bottom = 31.0
size_flags_horizontal = 3
disabled = true
text = "Next"

[node name="ResultsGridContainer" type="GridContainer" parent="LeadboardPanel"]
layout_mode = 0
offset_left = 4.0
offset_top = 48.0
offset_right = 639.0
offset_bottom = 538.0

[node name="FooterGridContainer" type="GridContainer" parent="LeadboardPanel"]
layout_mode = 0
offset_left = 6.0
offset_top = 561.0
offset_right = 636.0
offset_bottom = 601.0

[connection signal="leaderboard_results_changed" from="EasyLeaderboard" to="." method="_on_easy_leaderboard_leaderboard_results_changed"]
[connection signal="leaderboard_score_submitted" from="EasyLeaderboard" to="." method="_on_easy_leaderboard_leaderboard_score_submitted"]
